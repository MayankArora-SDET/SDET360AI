<div class="flex flex-col gap-4">
    <label for="ticket" class=" mr-4 pt-2 mt-4">{{testCaseHeadings[activeTab]}}
    </label>
    <div class=" w-full flex items-start mt-1   gap-3">
        <app-multiple-input #multipleInput (dataEmitter)="handleticketList($event)"
            class="w-3/4 min-w-[100px] "></app-multiple-input>
        <button class="rounded-md text-white font-semibold  bg-[#1B59F8] p-1 h-10 " (click)="GenerateData()"
            [disabled]="isLoading?true:false" [ngClass]="{'opacity-50':isLoading}">Generate</button>
    </div>
</div>
<div class="min-h-[300px] h-auto my-2">
    <div *ngIf="isLoading" class="flex justify-center items-center gap-5 ">
        <app-animation-ping></app-animation-ping>
        <p class="text-xs text-gray-600">Generating test cases for
            {{ ticketsSentForResponse.length > 1 ? activeTab + "'s" : activeTab }} :
            {{ticketsSentForResponse.toString()}}</p>
    </div>
    <div class="markdown" *ngIf="ticketData || epicTicketData">
        <div class="flex mb-2 items-center mt-3 gap-4">
            <h4 class="font-bold h-auto flex-1 flex-wrap whitespace-normal break-all text-[#354f92df]">Test
                Cases
                Generated for
                {{ticketsSentForResponse.toString()}}
            </h4>
            <button class="bg-black text-white text-sm px-1 py-2 rounded-md mr-4" id="exportTestCases"
                *ngIf="isExportServiceRequired" (click)="onExportClick()">Export</button>
            <button (click)="selectAllTestCases($event)" *ngIf="isExportServiceRequired"
                class="bg-black text-white text-sm px-1 py-2 rounded-md mr-4">Select
                All</button>
        </div>
        <div>
            <div *ngIf="activeTab !== 'epic'; else epicTemplate">
                <div *ngIf="ticketData">
                    <!-- Single-nested case -->
                    <div *ngFor="let ticket of getObjectKeys(ticketData)">
                        <strong>{{ ticket }}</strong>
                        <app-modified-markdown #modifiedMarkdown [data]="ticketData[ticket].aiResponse"
                            *ngIf="isExportServiceRequired; else noExport"></app-modified-markdown>

                        <ng-template #noExport>
                            <markdown [data]="ticketData[ticket].aiResponse"></markdown>
                        </ng-template>
                    </div>
                </div>
            </div>

            <!-- Double-nested (epic) -->
            <ng-template #epicTemplate>

                <div *ngIf="epicTicketData">
                    <div *ngFor="let epicKey of getObjectKeys(epicTicketData)">
                        <p
                            class="border-solid uppercase border-blue-900 border-b-[1px] text-blue-900 text-[16px] my-1 font-semibold">
                            {{
                            epicKey }}
                        </p>

                        <div *ngFor="let storyKey of getObjectKeys(epicTicketData[epicKey])">
                            <strong>{{ storyKey }}</strong>
                            <app-modified-markdown #modifiedMarkdown
                                [data]="epicTicketData[epicKey][storyKey].aiResponse"
                                *ngIf="isExportServiceRequired; else noExport"></app-modified-markdown>

                            <ng-template #noExport>
                                <markdown [data]="epicTicketData[epicKey][storyKey].aiResponse"></markdown>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>
    <div *ngIf="errorResponse" class="font-semibold text-red-700 font-mono text-center">
        {{errorResponse}}
    </div>

</div>